# 增强功能
ESAP增强了ES系统功能，以便ES更好的服务于企业。

- [邮件接口](#邮件接口)

- [超级回调](#超级回调)

- [微信办理](#微信办理)

- [移植ESAP](#移植ESAP)

## 邮件接口

ESAP实现了自己的邮件接口，可以加入图片或附件,发给多人时使用分号(;)或逗号(,)分隔。

![](./img/8.2.png)

效果图：

![](./img/8.3.png)

* 使用前提：
 * 1.开启网盘并设置了系统网盘；
 * 2.开启了邮件通知并设置邮件服务器。

![](./img/8.1.png)

* 下载导入 `email` 模板(支持9.2+)。

> 2.3+

## 超级回调

* ESAP对企业小助手回调接口进行了增强，可以自定义SQL语句，自定义权限，实现引擎式超级查询。

* 使用前提：
 * 1.开启企业小助手的回调模式(回调URL示例：http://阿里云IP:9090/wx)；
 * 2.导入`微信查询` 模板。

![](./img/8.4.png)

#### 支持多重权限，用逗号隔开

![](./img/8.6.png)

#### 支持企业号通讯录变量
* \{\{姓名\}\} 对应 `姓名`
* \{\{账号\}\} 对应 `账号`
* \{\{部门\}\} 对应 `部门`
* \{\{职位\}\} 对应 `职位`
* \{\{性别\}\} 对应 `性别`
* \{\{手机\}\} 对应 `手机号`
* \{\{邮箱\}\} 对应 `邮箱`

效果图：

<img src="./img/8.5.jpg" width="240">
<img src="./img/8.7.png" width="240">
<img src="./img/8.8.png" width="240">

#### 支持语音查询
<img src="./img/8.13.png" width="240">
<img src="./img/8.14.png" width="240">
<img src="./img/8.15.png" width="240">

#### 支持扫码查询(二维码/条码)
![](./img/8.19.png)
![](./img/8.17.png)
<img src="./img/8.16.png" width="240">
<img src="./img/8.6.jpg" width="240">
<img src="./img/8.18.png" width="240">

#### 支持图片/附件查询，sql结果字段或别名为`pic`或`图片`，`files`或`附件`
![](./img/8.20.png)

* 支持多个`图片`或`附件`

![](./img/8.21.png)
<img src="./img/8.21.jpg" width="240">
<img src="./img/8.22.jpg" width="240">

> 注意微信限制：图片一般不能超过2M,附件不超过20M

#### 支持回写模式，sql中使用update或insert
![](./img/8.22.png)
![](./img/8.23.png)
<img src="./img/8.24.jpg" width="240">

> 2.5+

#### 支持微信填报
![](./img/8.24.png)
<img src="./img/8.25.jpg" width="240">
<img src="./img/8.26.jpg" width="240">

> 2.5+

#### 支持菜单填报
![](./img/8.25.png)
<img src="./img/8.27.jpg" width="320">
<img src="./img/8.28.jpg" width="320">

> 2.5+

## 微信办理
ESAP对微信提醒进行了工作流增强，可直接通过微信提醒办理ES待办事宜。

* 导入`微信提醒`模板；
* 确保你的Esweb能够正常访问，工作流模板勾选了网页填报。
* 配置了`Host`参数为外网可用域名或IP，`EsWeb`参数为可访问的esweb的url(最后面不要有斜杠)；
* 配置Esweb根目录的web.config文件的`RequestMainURL`键值为`http://HostIP或域名:ESAP端口/wi`(最后面不要有斜杠)

例如：
```
<add key="RequestMainURL" value="http://io.erp8.net:9090/wi" />
```

* 修改Esweb\main\Framemain.aspx，head下增加一个<meta>标签，以便适应移动访问，内容如下：

```
<meta name="viewport" content="width=device-width,initial-scale=1">
```

效果图：

<img src="./img/8.9.png" width="240">
<img src="./img/8.10.png" width="240">
<img src="./img/8.11.png" width="240">

> 2.4+

## 移植ESAP
ESAP服务器直接与MSSQL交互，使用MSSQL的程序或系统都可以移植，包括并不限于下列项目：

+ 勤哲Excel服务器
+ 冠日网络Excel平台
+ 金蝶
+ 用友
+ 速达
+ SAP
+ FineReport
+ 快表
+ 云表

#### 移植到Excel服务器

* 如果你使用的是9.4+版，恭喜你，只需要将wechat_tmp中的`微信模板`导入到你的生产应用中，然后启动esap服务器即可。

* 如果是es9.4以下版本，例如7.1.7，8.4，9.2等，则需要自行建立这些`微信模板`，并保证表名和字段名一致即可。

#### 移植其他平台或ERP系统

* 只要是使用MSSQL，都可以自行建立这些`微信模板`的数据表，并保证名称类型一致即可。
